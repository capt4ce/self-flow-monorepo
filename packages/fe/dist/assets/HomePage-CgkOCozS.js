import{r as c,n as e,R as Ge}from"./vendor-react-tYkQlTQi.js";import{D as ce,C as me,P as fe}from"./vendor-ui-extras-CuoCuRK-.js";import{u as re,D as xe,a as be,b as De,c as he,B as M,d as K,e as J,f as Pe}from"./index-B2yiPlNq.js";import{T as He,a as Me,b as ue,c as de,d as Se}from"./TaskDialog-DECGOoM7.js";import{G as ke,m as pe,T as ge}from"./moveElement-BC8fn0W0.js";import{C as je,a as we,b as ve,c as Te}from"./card-8r8oBd_e.js";import{X as We,P as ee,c as Oe,f as I,d as Ie,e as Re,g as Fe,D as Le}from"./vendor-date-charts-B43nfnO2.js";import"./vendor-DNP07iVI.js";import"./vendor-forms-B4oTGqCB.js";import"./vendor-router-DyZlD0AS.js";const $e={Main:"bg-yellow-400",Yearly:"bg-orange-400",Quarterly:"bg-red-400",Monthly:"bg-green-400",Weekly:"bg-blue-400",Daily:"bg-purple-400"},Ae=["Main","Yearly","Quarterly","Monthly","Weekly"],Ye=({open:i,onOpenChange:b,date:N})=>{const{user:w}=re(),[v,h]=c.useState([]),[L,U]=c.useState(!1),[$,V]=c.useState(!1);c.useEffect(()=>{if(!i||!w||!N)return;(async()=>{U(!0);try{const f=await K.goals.list("active");h(f.data||[])}catch(f){console.error("Error fetching goals:",f)}finally{U(!1)}})()},[i,w,N]);const S=(l,f)=>{if(l.category==="Main")return l.status!=="done";if(l.status!=="active")return!1;const m=f.toISOString().split("T")[0];return!l.startDate&&!l.endDate?!0:l.startDate&&l.endDate?m>=l.startDate&&m<=l.endDate:l.startDate?m>=l.startDate:l.endDate?m<=l.endDate:!1},Y=(()=>{if(!N)return{};const l=v.filter(m=>S(m,N)),f={};return l.forEach(m=>{const k=m.category;f[k]||(f[k]=[]),f[k].push(m)}),f})(),C=Object.values(Y).reduce((l,f)=>l+f.length,0),x=(l,f)=>{if(!l&&!f)return"";if(l&&f){const m=new Date(l),k=new Date(f);return`${I(m,"MMM d")} - ${I(k,"MMM d")}`}return l?`From ${I(new Date(l),"MMM d")}`:f?`Until ${I(new Date(f),"MMM d")}`:""},_=l=>I(l,"EEEE, MMMM d, yyyy"),Q=()=>{w&&K.goals.list("active").then(l=>{h(l.data||[])}).catch(l=>{console.error("Error refreshing goals:",l)})};return N?e.jsxDEV(e.Fragment,{children:[e.jsxDEV(xe,{open:i,onOpenChange:b,children:e.jsxDEV(be,{className:"max-w-3xl max-h-[90vh] overflow-y-auto w-[95vw] sm:w-full",children:[e.jsxDEV(De,{className:"relative",children:[e.jsxDEV(he,{className:"text-xl sm:text-2xl font-bold pr-8",children:["Goals for ",_(N)]},void 0,!0,{fileName:"/Users/ali/projects/self-flow-monorepo/packages/fe/src/components/dialogs/DateGoalsDialog.tsx",lineNumber:168,columnNumber:13},void 0),e.jsxDEV("p",{className:"text-sm text-muted-foreground",children:[C," active ",C===1?"goal":"goals"]},void 0,!0,{fileName:"/Users/ali/projects/self-flow-monorepo/packages/fe/src/components/dialogs/DateGoalsDialog.tsx",lineNumber:171,columnNumber:13},void 0),e.jsxDEV(M,{variant:"ghost",size:"icon",className:"absolute top-0 right-0",onClick:()=>b(!1),children:e.jsxDEV(We,{className:"h-4 w-4"},void 0,!1,{fileName:"/Users/ali/projects/self-flow-monorepo/packages/fe/src/components/dialogs/DateGoalsDialog.tsx",lineNumber:180,columnNumber:15},void 0)},void 0,!1,{fileName:"/Users/ali/projects/self-flow-monorepo/packages/fe/src/components/dialogs/DateGoalsDialog.tsx",lineNumber:174,columnNumber:13},void 0)]},void 0,!0,{fileName:"/Users/ali/projects/self-flow-monorepo/packages/fe/src/components/dialogs/DateGoalsDialog.tsx",lineNumber:167,columnNumber:11},void 0),e.jsxDEV("div",{className:"space-y-4",children:[e.jsxDEV(M,{onClick:()=>V(!0),className:"w-full bg-blue-600 hover:bg-blue-700 text-white",children:[e.jsxDEV(ee,{className:"h-4 w-4 mr-2"},void 0,!1,{fileName:"/Users/ali/projects/self-flow-monorepo/packages/fe/src/components/dialogs/DateGoalsDialog.tsx",lineNumber:190,columnNumber:15},void 0),"Create New Goal"]},void 0,!0,{fileName:"/Users/ali/projects/self-flow-monorepo/packages/fe/src/components/dialogs/DateGoalsDialog.tsx",lineNumber:186,columnNumber:13},void 0),L?e.jsxDEV("div",{className:"text-center py-8 text-muted-foreground",children:"Loading goals..."},void 0,!1,{fileName:"/Users/ali/projects/self-flow-monorepo/packages/fe/src/components/dialogs/DateGoalsDialog.tsx",lineNumber:195,columnNumber:15},void 0):C===0?e.jsxDEV("div",{className:"text-center py-8 text-muted-foreground",children:"No active goals for this date."},void 0,!1,{fileName:"/Users/ali/projects/self-flow-monorepo/packages/fe/src/components/dialogs/DateGoalsDialog.tsx",lineNumber:199,columnNumber:15},void 0):Ae.map(l=>{const f=Y[l]||[];return f.length===0?null:e.jsxDEV("div",{className:"space-y-3",children:[e.jsxDEV("div",{className:"flex items-center gap-2",children:[e.jsxDEV("div",{className:`w-3 h-3 rounded-full ${$e[l]}`},void 0,!1,{fileName:"/Users/ali/projects/self-flow-monorepo/packages/fe/src/components/dialogs/DateGoalsDialog.tsx",lineNumber:212,columnNumber:23},void 0),e.jsxDEV("h3",{className:"font-semibold text-base",children:[l," (",f.length,")"]},void 0,!0,{fileName:"/Users/ali/projects/self-flow-monorepo/packages/fe/src/components/dialogs/DateGoalsDialog.tsx",lineNumber:215,columnNumber:23},void 0)]},void 0,!0,{fileName:"/Users/ali/projects/self-flow-monorepo/packages/fe/src/components/dialogs/DateGoalsDialog.tsx",lineNumber:211,columnNumber:21},void 0),f.map(m=>{const k=m.tasks||[],G=m.taskCount||k.length,z=m.completedTaskCount||k.filter(s=>s.completed).length,y=G>0?z/G*100:0;return e.jsxDEV(je,{className:"bg-white",children:[e.jsxDEV(we,{className:"pb-3",children:[e.jsxDEV("div",{className:"flex items-start justify-between gap-2 mb-2",children:[e.jsxDEV("h4",{className:"font-semibold text-base flex-1",children:m.title},void 0,!1,{fileName:"/Users/ali/projects/self-flow-monorepo/packages/fe/src/components/dialogs/DateGoalsDialog.tsx",lineNumber:234,columnNumber:31},void 0),e.jsxDEV("div",{className:"flex flex-col items-end",children:[(m.startDate||m.endDate)&&e.jsxDEV("span",{className:"text-xs text-muted-foreground whitespace-nowrap",children:x(m.startDate,m.endDate)},void 0,!1,{fileName:"/Users/ali/projects/self-flow-monorepo/packages/fe/src/components/dialogs/DateGoalsDialog.tsx",lineNumber:239,columnNumber:35},void 0),G>0&&e.jsxDEV("span",{className:"text-xs text-muted-foreground mt-1",children:[z,"/",G," tasks"]},void 0,!0,{fileName:"/Users/ali/projects/self-flow-monorepo/packages/fe/src/components/dialogs/DateGoalsDialog.tsx",lineNumber:244,columnNumber:35},void 0)]},void 0,!0,{fileName:"/Users/ali/projects/self-flow-monorepo/packages/fe/src/components/dialogs/DateGoalsDialog.tsx",lineNumber:237,columnNumber:31},void 0)]},void 0,!0,{fileName:"/Users/ali/projects/self-flow-monorepo/packages/fe/src/components/dialogs/DateGoalsDialog.tsx",lineNumber:233,columnNumber:29},void 0),G>0&&e.jsxDEV("div",{className:"mt-2 space-y-1",children:[e.jsxDEV("div",{className:"text-xs text-muted-foreground",children:"Progress"},void 0,!1,{fileName:"/Users/ali/projects/self-flow-monorepo/packages/fe/src/components/dialogs/DateGoalsDialog.tsx",lineNumber:252,columnNumber:33},void 0),e.jsxDEV("div",{className:"w-full bg-gray-200 rounded-full h-2",children:e.jsxDEV("div",{className:"bg-blue-500 h-2 rounded-full transition-all",style:{width:`${y}%`}},void 0,!1,{fileName:"/Users/ali/projects/self-flow-monorepo/packages/fe/src/components/dialogs/DateGoalsDialog.tsx",lineNumber:256,columnNumber:35},void 0)},void 0,!1,{fileName:"/Users/ali/projects/self-flow-monorepo/packages/fe/src/components/dialogs/DateGoalsDialog.tsx",lineNumber:255,columnNumber:33},void 0)]},void 0,!0,{fileName:"/Users/ali/projects/self-flow-monorepo/packages/fe/src/components/dialogs/DateGoalsDialog.tsx",lineNumber:251,columnNumber:31},void 0)]},void 0,!0,{fileName:"/Users/ali/projects/self-flow-monorepo/packages/fe/src/components/dialogs/DateGoalsDialog.tsx",lineNumber:232,columnNumber:27},void 0),e.jsxDEV(ve,{children:k.length>0?e.jsxDEV("div",{className:"space-y-2",children:k.map(s=>{const r=s.completed||s.status==="completed",t=s.status==="not done";return e.jsxDEV("div",{className:"flex items-center gap-2",children:[e.jsxDEV("div",{className:`flex-shrink-0 w-4 h-4 rounded-full border-2 flex items-center justify-center ${r?"border-green-500 bg-green-50":"border-gray-300"}`,children:r&&e.jsxDEV(Oe,{className:"w-3 h-3 text-green-600"},void 0,!1,{fileName:"/Users/ali/projects/self-flow-monorepo/packages/fe/src/components/dialogs/DateGoalsDialog.tsx",lineNumber:287,columnNumber:43},void 0)},void 0,!1,{fileName:"/Users/ali/projects/self-flow-monorepo/packages/fe/src/components/dialogs/DateGoalsDialog.tsx",lineNumber:279,columnNumber:39},void 0),e.jsxDEV("span",{className:`text-sm flex-1 ${r||t?"line-through text-muted-foreground":"text-foreground"}`,children:s.title},void 0,!1,{fileName:"/Users/ali/projects/self-flow-monorepo/packages/fe/src/components/dialogs/DateGoalsDialog.tsx",lineNumber:290,columnNumber:39},void 0)]},s.id,!0,{fileName:"/Users/ali/projects/self-flow-monorepo/packages/fe/src/components/dialogs/DateGoalsDialog.tsx",lineNumber:275,columnNumber:37},void 0)})},void 0,!1,{fileName:"/Users/ali/projects/self-flow-monorepo/packages/fe/src/components/dialogs/DateGoalsDialog.tsx",lineNumber:268,columnNumber:31},void 0):e.jsxDEV("p",{className:"text-xs text-muted-foreground",children:"No tasks yet."},void 0,!1,{fileName:"/Users/ali/projects/self-flow-monorepo/packages/fe/src/components/dialogs/DateGoalsDialog.tsx",lineNumber:304,columnNumber:31},void 0)},void 0,!1,{fileName:"/Users/ali/projects/self-flow-monorepo/packages/fe/src/components/dialogs/DateGoalsDialog.tsx",lineNumber:266,columnNumber:27},void 0)]},m.id,!0,{fileName:"/Users/ali/projects/self-flow-monorepo/packages/fe/src/components/dialogs/DateGoalsDialog.tsx",lineNumber:231,columnNumber:25},void 0)})]},l,!0,{fileName:"/Users/ali/projects/self-flow-monorepo/packages/fe/src/components/dialogs/DateGoalsDialog.tsx",lineNumber:209,columnNumber:19},void 0)})]},void 0,!0,{fileName:"/Users/ali/projects/self-flow-monorepo/packages/fe/src/components/dialogs/DateGoalsDialog.tsx",lineNumber:184,columnNumber:11},void 0)]},void 0,!0,{fileName:"/Users/ali/projects/self-flow-monorepo/packages/fe/src/components/dialogs/DateGoalsDialog.tsx",lineNumber:166,columnNumber:9},void 0)},void 0,!1,{fileName:"/Users/ali/projects/self-flow-monorepo/packages/fe/src/components/dialogs/DateGoalsDialog.tsx",lineNumber:165,columnNumber:7},void 0),e.jsxDEV(ke,{open:$,onOpenChange:V,goal:null,onSaved:Q},void 0,!1,{fileName:"/Users/ali/projects/self-flow-monorepo/packages/fe/src/components/dialogs/DateGoalsDialog.tsx",lineNumber:321,columnNumber:7},void 0)]},void 0,!0,{fileName:"/Users/ali/projects/self-flow-monorepo/packages/fe/src/components/dialogs/DateGoalsDialog.tsx",lineNumber:164,columnNumber:5},void 0):null},_e={Main:"bg-yellow-400",Yearly:"bg-orange-400",Quarterly:"bg-red-400",Monthly:"bg-green-400",Weekly:"bg-blue-400",Daily:"bg-purple-400"},ze=["Main","Yearly","Quarterly","Monthly","Weekly"],Be=({selectedDate:i,onDateChange:b,onOpenMonthCalendar:N,goalsRefreshKey:w})=>{const[v,h]=c.useState(0),[L,U]=c.useState([]),{user:$}=re(),[V,S]=c.useState(!1),[A,Y]=c.useState(null);c.useEffect(()=>{if(!$)return;(async()=>{try{const r=await K.goals.list("active");U(r.data||[])}catch(r){console.error("Error fetching goals:",r)}})()},[$,w]);const C=(s,r)=>{if(s.category==="Main")return s.status!=="done";if(s.status!=="active")return!1;const t=I(r,"yyyy-MM-dd");return!s.startDate&&!s.endDate?!0:s.startDate&&s.endDate?t>=s.startDate&&t<=s.endDate:s.startDate?t>=s.startDate:s.endDate?t<=s.endDate:!1},x=s=>{const r=I(s,"yyyy-MM-dd");return L.some(t=>t.category!=="Daily"||t.status!=="active"?!1:!t.startDate&&!t.endDate?!0:t.startDate&&t.endDate?r>=t.startDate&&r<=t.endDate:t.startDate?r>=t.startDate:t.endDate?r<=t.endDate:!1)},_=s=>{const r=L.filter(d=>C(d,s)),t={Main:!1,Yearly:!1,Quarterly:!1,Monthly:!1,Weekly:!1,Daily:!1};return r.forEach(d=>{d.category in t&&(t[d.category]=!0)}),t},Q=c.useMemo(()=>{const s=new Date;s.setHours(0,0,0,0);const r=new Date(s);r.setDate(s.getDate()-3+v*7);const t=[];for(let d=0;d<7;d++){const E=new Date(r);E.setDate(r.getDate()+d),t.push(E)}return t},[v]),l=()=>{h(v-1)},f=()=>{h(v+1)},m=()=>{h(0);const s=new Date;s.setHours(0,0,0,0),b(s)},k=s=>{try{return!s||!(s instanceof Date)||isNaN(s.getTime())?"":s.getDate().toString()}catch(r){return console.error("Error formatting day:",r),""}},G=s=>{try{return!s||!(s instanceof Date)||isNaN(s.getTime())?"":s.toLocaleDateString("en-US",{weekday:"short"})}catch(r){return console.error("Error formatting day name:",r),""}},z=s=>{const r=new Date;return s.getDate()===r.getDate()&&s.getMonth()===r.getMonth()&&s.getFullYear()===r.getFullYear()},y=s=>!i||!(i instanceof Date)?!1:s.getDate()===i.getDate()&&s.getMonth()===i.getMonth()&&s.getFullYear()===i.getFullYear();return Ge.useEffect(()=>{if(!i||!(i instanceof Date))return;const s=new Date;s.setHours(0,0,0,0);const r=new Date(i);r.setHours(0,0,0,0),h(t=>{const d=new Date(s);d.setDate(s.getDate()-3+t*7);const E=new Date(d);if(E.setDate(d.getDate()+6),r<d||r>E){const X=Math.floor((r.getTime()-s.getTime())/864e5);return Math.round((X+3)/7)}return t})},[i]),e.jsxDEV("div",{className:"flex flex-col sm:flex-row items-center gap-2 p-2 sm:p-4 border-b bg-card",children:[e.jsxDEV("div",{className:"flex flex-1 items-center gap-1 sm:gap-2 w-full sm:w-auto",children:[e.jsxDEV(M,{variant:"outline",size:"icon",onClick:l,className:"h-7 w-7 sm:h-8 sm:w-8 flex-shrink-0",children:e.jsxDEV(Ie,{className:"h-3 w-3 sm:h-4 sm:w-4"},void 0,!1,{fileName:"/Users/ali/projects/self-flow-monorepo/packages/fe/src/components/common/WeekCalendarWidget.tsx",lineNumber:266,columnNumber:11},void 0)},void 0,!1,{fileName:"/Users/ali/projects/self-flow-monorepo/packages/fe/src/components/common/WeekCalendarWidget.tsx",lineNumber:260,columnNumber:9},void 0),e.jsxDEV("div",{className:"flex-1 flex items-center justify-center gap-1 sm:gap-2 overflow-x-auto",children:Q.map(s=>{const r=`${s.getFullYear()}-${s.getMonth()}-${s.getDate()}`,t=y(s),d=z(s),E=_(s),X=x(s);return e.jsxDEV("button",{onClick:()=>b(s),className:J("relative flex flex-col items-center justify-center w-12 h-20 sm:w-14 sm:h-24 rounded-lg transition-all duration-200 flex-shrink-0","hover:bg-accent/50",t&&"bg-background border-2 border-foreground shadow-md",!t&&d&&"bg-accent/50",!t&&!d&&"hover:border hover:border-border"),children:[e.jsxDEV("div",{className:"absolute top-1 left-1/2 -translate-x-1/2 flex flex-col gap-0.5 cursor-pointer z-10",onClick:T=>{T.stopPropagation(),Y(s),S(!0)},title:"Click to view goals for this date",children:ze.map(T=>{const se=E[T];return e.jsxDEV("div",{className:J("w-6 sm:w-7 h-1 rounded-sm",se?_e[T]:"bg-gray-300 opacity-40")},T,!1,{fileName:"/Users/ali/projects/self-flow-monorepo/packages/fe/src/components/common/WeekCalendarWidget.tsx",lineNumber:306,columnNumber:23},void 0)})},void 0,!1,{fileName:"/Users/ali/projects/self-flow-monorepo/packages/fe/src/components/common/WeekCalendarWidget.tsx",lineNumber:294,columnNumber:17},void 0),e.jsxDEV("span",{className:J("text-xs sm:text-sm font-medium mt-4 sm:mt-5",t?"text-foreground font-semibold":d&&!t?"text-foreground":"text-muted-foreground"),children:G(s)},void 0,!1,{fileName:"/Users/ali/projects/self-flow-monorepo/packages/fe/src/components/common/WeekCalendarWidget.tsx",lineNumber:320,columnNumber:17},void 0),e.jsxDEV("span",{className:J("text-base sm:text-lg font-semibold",t&&"text-foreground",!t&&d&&"text-foreground"),children:k(s)},void 0,!1,{fileName:"/Users/ali/projects/self-flow-monorepo/packages/fe/src/components/common/WeekCalendarWidget.tsx",lineNumber:334,columnNumber:17},void 0),X&&e.jsxDEV("div",{className:"absolute bottom-1 left-1/2 -translate-x-1/2 w-1.5 h-1.5 sm:w-2 sm:h-2 rounded-full bg-purple-500"},void 0,!1,{fileName:"/Users/ali/projects/self-flow-monorepo/packages/fe/src/components/common/WeekCalendarWidget.tsx",lineNumber:346,columnNumber:19},void 0)]},r,!0,{fileName:"/Users/ali/projects/self-flow-monorepo/packages/fe/src/components/common/WeekCalendarWidget.tsx",lineNumber:278,columnNumber:15},void 0)})},void 0,!1,{fileName:"/Users/ali/projects/self-flow-monorepo/packages/fe/src/components/common/WeekCalendarWidget.tsx",lineNumber:269,columnNumber:9},void 0),e.jsxDEV(M,{variant:"outline",size:"icon",onClick:f,className:"h-7 w-7 sm:h-8 sm:w-8 flex-shrink-0",children:e.jsxDEV(Re,{className:"h-3 w-3 sm:h-4 sm:w-4"},void 0,!1,{fileName:"/Users/ali/projects/self-flow-monorepo/packages/fe/src/components/common/WeekCalendarWidget.tsx",lineNumber:359,columnNumber:11},void 0)},void 0,!1,{fileName:"/Users/ali/projects/self-flow-monorepo/packages/fe/src/components/common/WeekCalendarWidget.tsx",lineNumber:353,columnNumber:9},void 0)]},void 0,!0,{fileName:"/Users/ali/projects/self-flow-monorepo/packages/fe/src/components/common/WeekCalendarWidget.tsx",lineNumber:259,columnNumber:7},void 0),e.jsxDEV("div",{className:"flex items-center gap-1 sm:gap-2 w-full sm:w-auto",children:[e.jsxDEV(M,{variant:"outline",size:"sm",onClick:N,className:"h-7 sm:h-8 text-xs sm:text-sm px-2 sm:px-3 flex-1 sm:flex-initial",children:[e.jsxDEV(Fe,{className:"h-3 w-3 sm:h-4 sm:w-4 sm:mr-2"},void 0,!1,{fileName:"/Users/ali/projects/self-flow-monorepo/packages/fe/src/components/common/WeekCalendarWidget.tsx",lineNumber:370,columnNumber:11},void 0),e.jsxDEV("span",{className:"hidden sm:inline",children:"Month"},void 0,!1,{fileName:"/Users/ali/projects/self-flow-monorepo/packages/fe/src/components/common/WeekCalendarWidget.tsx",lineNumber:371,columnNumber:11},void 0)]},void 0,!0,{fileName:"/Users/ali/projects/self-flow-monorepo/packages/fe/src/components/common/WeekCalendarWidget.tsx",lineNumber:364,columnNumber:9},void 0),e.jsxDEV(M,{variant:"outline",size:"sm",onClick:m,className:"h-7 sm:h-8 text-xs sm:text-sm px-2 sm:px-3 flex-1 sm:flex-initial",children:"Today"},void 0,!1,{fileName:"/Users/ali/projects/self-flow-monorepo/packages/fe/src/components/common/WeekCalendarWidget.tsx",lineNumber:374,columnNumber:9},void 0)]},void 0,!0,{fileName:"/Users/ali/projects/self-flow-monorepo/packages/fe/src/components/common/WeekCalendarWidget.tsx",lineNumber:363,columnNumber:7},void 0),e.jsxDEV(Ye,{open:V,onOpenChange:S,date:A},void 0,!1,{fileName:"/Users/ali/projects/self-flow-monorepo/packages/fe/src/components/common/WeekCalendarWidget.tsx",lineNumber:385,columnNumber:7},void 0)]},void 0,!0,{fileName:"/Users/ali/projects/self-flow-monorepo/packages/fe/src/components/common/WeekCalendarWidget.tsx",lineNumber:258,columnNumber:5},void 0)};function ye({classNames:i,showOutsideDays:b=!0,...N}){return e.jsxDEV(Le,{showOutsideDays:b,classNames:{day:J("h-8 w-8 p-0 font-normal aria-selected:opacity-100"),...i},...N},void 0,!1,{fileName:"/Users/ali/projects/self-flow-monorepo/packages/fe/src/components/ui/calendar.tsx",lineNumber:14,columnNumber:5},this)}ye.displayName="Calendar";const Ke=({open:i,onOpenChange:b,selectedDate:N,onDateSelect:w})=>{const v=h=>{h&&(w(h),b(!1))};return e.jsxDEV(xe,{open:i,onOpenChange:b,children:e.jsxDEV(be,{className:"sm:max-w-[425px]",children:[e.jsxDEV(De,{children:e.jsxDEV(he,{children:"Select Date"},void 0,!1,{fileName:"/Users/ali/projects/self-flow-monorepo/packages/fe/src/components/dialogs/MonthCalendarDialog.tsx",lineNumber:35,columnNumber:11},void 0)},void 0,!1,{fileName:"/Users/ali/projects/self-flow-monorepo/packages/fe/src/components/dialogs/MonthCalendarDialog.tsx",lineNumber:34,columnNumber:9},void 0),e.jsxDEV("div",{className:"flex justify-center py-4",children:e.jsxDEV(ye,{mode:"single",selected:N,onSelect:v},void 0,!1,{fileName:"/Users/ali/projects/self-flow-monorepo/packages/fe/src/components/dialogs/MonthCalendarDialog.tsx",lineNumber:38,columnNumber:11},void 0)},void 0,!1,{fileName:"/Users/ali/projects/self-flow-monorepo/packages/fe/src/components/dialogs/MonthCalendarDialog.tsx",lineNumber:37,columnNumber:9},void 0)]},void 0,!0,{fileName:"/Users/ali/projects/self-flow-monorepo/packages/fe/src/components/dialogs/MonthCalendarDialog.tsx",lineNumber:33,columnNumber:7},void 0)},void 0,!1,{fileName:"/Users/ali/projects/self-flow-monorepo/packages/fe/src/components/dialogs/MonthCalendarDialog.tsx",lineNumber:32,columnNumber:5},void 0)},Z=[{key:"todo",label:"To Do"},{key:"in progress",label:"In Progress"},{key:"blocked",label:"Blocked"},{key:"completed",label:"Completed"}],Ne=i=>{switch(i){case"in progress":case"blocked":return i;case"completed":case"not done":return"completed";case"todo":case null:default:return"todo"}},Qe=i=>{switch(i){case"in progress":case"blocked":return i;case"completed":return"completed";case"todo":default:return"todo"}};function ns(){const{user:i,loading:b}=re(),[N,w]=c.useState([]),[v,h]=c.useState(!0),[L,U]=c.useState(!1),[$,V]=c.useState(!1),[S,A]=c.useState(null),[Y,C]=c.useState({title:"",description:"",status:"todo",completed:!1}),[x,_]=c.useState(()=>{const o=new Date;return o.setHours(0,0,0,0),o}),[Q,l]=c.useState(!1),[f,m]=c.useState(0),{refreshSubtasks:k}=Pe(),[G,z]=c.useState("list"),y=c.useCallback(async()=>{if(i){h(!0);try{const o=await K.goals.list("active");w(o.data||[])}catch(o){console.error("Error fetching goals:",o)}finally{h(!1)}}},[i]);c.useEffect(()=>{i&&!b?y():!b&&!i&&h(!1)},[i,b,y]);const s=c.useCallback(o=>{const a=I(o,"yyyy-MM-dd");return N.find(n=>n.category!=="Daily"||n.status!=="active"?!1:!n.startDate&&!n.endDate?!0:n.startDate&&n.endDate?a>=n.startDate&&a<=n.endDate:n.startDate?a>=n.startDate:n.endDate?a<=n.endDate:!1)||null},[N]),r=c.useMemo(()=>!x||!(x instanceof Date)?null:s(x),[x,s]),t=c.useMemo(()=>((r==null?void 0:r.tasks)||[]).slice().sort((o,a)=>{const n=(o==null?void 0:o.orderIndex)??0,u=(a==null?void 0:a.orderIndex)??0;return n-u}),[r]),d=c.useMemo(()=>{const o=Z.reduce((a,n)=>(a[n.key]=[],a),{});for(const a of t){const n=Ne(a.status??null);o[n].push(a)}return Object.keys(o).forEach(a=>{o[a].sort((n,u)=>((n==null?void 0:n.orderIndex)??0)-((u==null?void 0:u.orderIndex)??0))}),o},[t]),E=c.useCallback(async o=>{const{destination:a,source:n,draggableId:u}=o;if(!r||!a)return;const D=n.droppableId==="daily-task-list"&&a.droppableId==="daily-task-list",j=n.droppableId.startsWith("kanban-")&&a.droppableId.startsWith("kanban-");if(!D&&!j||a.droppableId===n.droppableId&&a.index===n.index)return;let P=null,ne=null;if(w(R=>R.map(p=>{if(p.id!==r.id)return p;const q=p.tasks?[...p.tasks]:[];if(q.length===0)return p;if(D)try{return P=pe(q,n.index,a.index).map((B,H)=>({...B,orderIndex:H})),{...p,tasks:P}}catch(W){return console.error("Error reordering tasks locally:",W),P=null,p}if(j){const W=n.droppableId.replace("kanban-",""),B=a.droppableId.replace("kanban-",""),H=Z.reduce((g,O)=>(g[O.key]=[],g),{});for(const g of q){if(!g.id||typeof g.id!="string")continue;const O=Ne(g.status??null);H[O].push(g)}let F;if(W===B)try{H[W]=pe(H[W],n.index,a.index),F=H[W][a.index]}catch(g){return console.error("Error reordering Kanban column:",g),p}else{const[g]=H[W].splice(n.index,1);if(!g)return console.warn("Moved task not found in source column"),p;const O=Qe(B),ae=B==="completed";F={...g,status:O,completed:ae},H[B].splice(a.index,0,F),ne={status:O,completed:ae}}return F?(P=Z.flatMap(g=>H[g.key]).map((g,O)=>({...F&&g.id===F.id?F:g,orderIndex:O})),{...p,tasks:P}):(console.warn("No task moved during Kanban drag operation"),p)}return p})),!P)return;const Ce=P,ie=ne;try{ie&&u&&typeof u=="string"&&await K.tasks.update(u,ie);const R=[];Ce.forEach((p,q)=>{typeof p.id=="string"&&R.push({taskId:p.id,orderIndex:q})}),R.length>0&&await K.tasks.reorder(R),m(p=>p+1)}catch(R){console.error("Error updating task order/status after drag:",R),await y()}},[y,r]),X=o=>{_(o)},T=()=>{l(!0)},se=o=>{if(o){const a=new Date(o);a.setHours(0,0,0,0),_(a)}},te=o=>{const a=N.find(n=>{var u;return(u=n.tasks)==null?void 0:u.some(D=>D.id===o.id)})||null;C({...o,status:o.status||"todo",goal_id:a==null?void 0:a.id}),U(!0)},le=c.useCallback((o,a,n)=>{w(u=>u.map(D=>!D.tasks||!D.tasks.some(j=>j.id===o)?D:{...D,tasks:D.tasks.map(j=>j.id===o?{...j,status:a,completed:n}:j)}))},[]),oe=()=>{C({title:"",description:"",status:"todo",completed:!1,goal_id:r==null?void 0:r.id}),U(!0)},Ee=()=>{const o=s(x);o?(A(o),V(!0)):(A(null),V(!0))};if(b||v)return e.jsxDEV("div",{className:"min-h-screen bg-background flex items-center justify-center",children:e.jsxDEV("p",{children:"Loading..."},void 0,!1,{fileName:"/Users/ali/projects/self-flow-monorepo/packages/fe/src/pages/HomePage.tsx",lineNumber:466,columnNumber:9},this)},void 0,!1,{fileName:"/Users/ali/projects/self-flow-monorepo/packages/fe/src/pages/HomePage.tsx",lineNumber:465,columnNumber:7},this);if(!i)return e.jsxDEV("div",{className:"min-h-screen bg-background flex items-center justify-center p-4",children:e.jsxDEV("div",{className:"w-full max-w-md space-y-4",children:e.jsxDEV("div",{className:"text-center space-y-2",children:[e.jsxDEV("h1",{className:"text-2xl font-bold",children:"Welcome to Self Flow"},void 0,!1,{fileName:"/Users/ali/projects/self-flow-monorepo/packages/fe/src/pages/HomePage.tsx",lineNumber:476,columnNumber:13},this),e.jsxDEV("p",{className:"text-muted-foreground",children:"Sign in or create an account to get started"},void 0,!1,{fileName:"/Users/ali/projects/self-flow-monorepo/packages/fe/src/pages/HomePage.tsx",lineNumber:477,columnNumber:13},this)]},void 0,!0,{fileName:"/Users/ali/projects/self-flow-monorepo/packages/fe/src/pages/HomePage.tsx",lineNumber:475,columnNumber:11},this)},void 0,!1,{fileName:"/Users/ali/projects/self-flow-monorepo/packages/fe/src/pages/HomePage.tsx",lineNumber:474,columnNumber:9},this)},void 0,!1,{fileName:"/Users/ali/projects/self-flow-monorepo/packages/fe/src/pages/HomePage.tsx",lineNumber:473,columnNumber:7},this);const Ue=o=>{if(!o||!(o instanceof Date)||isNaN(o.getTime()))return"Invalid date";try{return o.toLocaleDateString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric"})}catch(a){return console.error("Error formatting date:",a),"Invalid date"}},Ve=o=>{if(!o||!(o instanceof Date)||isNaN(o.getTime()))return"";try{return o.toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"})}catch(a){return console.error("Error formatting date for goal title:",a),""}};return e.jsxDEV("div",{className:"flex flex-col min-h-full",children:[e.jsxDEV(Be,{selectedDate:x,onDateChange:X,onOpenMonthCalendar:T,goalsRefreshKey:f},void 0,!1,{fileName:"/Users/ali/projects/self-flow-monorepo/packages/fe/src/pages/HomePage.tsx",lineNumber:522,columnNumber:7},this),e.jsxDEV("div",{className:"flex-1 p-3 sm:p-4 lg:p-6",children:e.jsxDEV("div",{className:"max-w-6xl mx-auto",children:[e.jsxDEV("div",{className:"mb-4 sm:mb-6",children:e.jsxDEV("div",{className:"flex flex-col sm:flex-row sm:justify-between sm:items-center gap-3",children:[e.jsxDEV("div",{className:"min-w-0 flex-1",children:[e.jsxDEV("h1",{className:"text-xl sm:text-2xl font-bold cursor-pointer hover:text-primary transition-colors",onClick:Ee,title:"Click to create or edit today's daily goal",children:"Daily Tasks"},void 0,!1,{fileName:"/Users/ali/projects/self-flow-monorepo/packages/fe/src/pages/HomePage.tsx",lineNumber:535,columnNumber:17},this),e.jsxDEV("p",{className:"text-sm sm:text-base text-muted-foreground truncate",children:(()=>{const o=s(x);return(o==null?void 0:o.title)||Ue(x)})()},void 0,!1,{fileName:"/Users/ali/projects/self-flow-monorepo/packages/fe/src/pages/HomePage.tsx",lineNumber:542,columnNumber:17},this)]},void 0,!0,{fileName:"/Users/ali/projects/self-flow-monorepo/packages/fe/src/pages/HomePage.tsx",lineNumber:534,columnNumber:15},this),e.jsxDEV(M,{onClick:oe,className:"flex items-center gap-2 w-full sm:w-auto",size:"sm",children:[e.jsxDEV(ee,{size:16},void 0,!1,{fileName:"/Users/ali/projects/self-flow-monorepo/packages/fe/src/pages/HomePage.tsx",lineNumber:556,columnNumber:17},this),"Add Task"]},void 0,!0,{fileName:"/Users/ali/projects/self-flow-monorepo/packages/fe/src/pages/HomePage.tsx",lineNumber:551,columnNumber:15},this)]},void 0,!0,{fileName:"/Users/ali/projects/self-flow-monorepo/packages/fe/src/pages/HomePage.tsx",lineNumber:533,columnNumber:13},this)},void 0,!1,{fileName:"/Users/ali/projects/self-flow-monorepo/packages/fe/src/pages/HomePage.tsx",lineNumber:532,columnNumber:11},this),v?e.jsxDEV("div",{className:"text-center py-8",children:e.jsxDEV("p",{children:"Loading tasks..."},void 0,!1,{fileName:"/Users/ali/projects/self-flow-monorepo/packages/fe/src/pages/HomePage.tsx",lineNumber:564,columnNumber:15},this)},void 0,!1,{fileName:"/Users/ali/projects/self-flow-monorepo/packages/fe/src/pages/HomePage.tsx",lineNumber:563,columnNumber:13},this):e.jsxDEV(je,{children:[e.jsxDEV(we,{children:e.jsxDEV(Te,{children:r?`Tasks (${t.length})`:"No Daily Goal Yet"},void 0,!1,{fileName:"/Users/ali/projects/self-flow-monorepo/packages/fe/src/pages/HomePage.tsx",lineNumber:569,columnNumber:17},this)},void 0,!1,{fileName:"/Users/ali/projects/self-flow-monorepo/packages/fe/src/pages/HomePage.tsx",lineNumber:568,columnNumber:15},this),e.jsxDEV(ve,{children:e.jsxDEV(He,{value:G,onValueChange:o=>z(o),children:[e.jsxDEV(Me,{className:"mb-4",children:[e.jsxDEV(ue,{value:"list",children:"List"},void 0,!1,{fileName:"/Users/ali/projects/self-flow-monorepo/packages/fe/src/pages/HomePage.tsx",lineNumber:583,columnNumber:21},this),e.jsxDEV(ue,{value:"kanban",children:"Kanban"},void 0,!1,{fileName:"/Users/ali/projects/self-flow-monorepo/packages/fe/src/pages/HomePage.tsx",lineNumber:584,columnNumber:21},this)]},void 0,!0,{fileName:"/Users/ali/projects/self-flow-monorepo/packages/fe/src/pages/HomePage.tsx",lineNumber:582,columnNumber:19},this),e.jsxDEV(de,{value:"list",children:t.length>0?e.jsxDEV(ce,{onDragEnd:E,children:e.jsxDEV(me,{droppableId:"daily-task-list",children:o=>e.jsxDEV("div",{className:"space-y-2",ref:o.innerRef,...o.droppableProps,children:[t.filter(a=>a.id&&typeof a.id=="string").map((a,n)=>e.jsxDEV(fe,{draggableId:a.id,index:n,children:(u,D)=>e.jsxDEV("div",{ref:u.innerRef,...u.draggableProps,...u.dragHandleProps,className:`rounded transition-shadow ${D.isDragging?"shadow-lg bg-muted":""}`,children:e.jsxDEV(ge,{task:a,onEditTask:te,onStatusChange:le},void 0,!1,{fileName:"/Users/ali/projects/self-flow-monorepo/packages/fe/src/pages/HomePage.tsx",lineNumber:619,columnNumber:41},this)},void 0,!1,{fileName:"/Users/ali/projects/self-flow-monorepo/packages/fe/src/pages/HomePage.tsx",lineNumber:609,columnNumber:39},this)},a.id,!1,{fileName:"/Users/ali/projects/self-flow-monorepo/packages/fe/src/pages/HomePage.tsx",lineNumber:603,columnNumber:35},this)),o.placeholder]},void 0,!0,{fileName:"/Users/ali/projects/self-flow-monorepo/packages/fe/src/pages/HomePage.tsx",lineNumber:592,columnNumber:29},this)},void 0,!1,{fileName:"/Users/ali/projects/self-flow-monorepo/packages/fe/src/pages/HomePage.tsx",lineNumber:590,columnNumber:25},this)},void 0,!1,{fileName:"/Users/ali/projects/self-flow-monorepo/packages/fe/src/pages/HomePage.tsx",lineNumber:589,columnNumber:23},this):r?e.jsxDEV("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsxDEV("p",{children:"No tasks for this date."},void 0,!1,{fileName:"/Users/ali/projects/self-flow-monorepo/packages/fe/src/pages/HomePage.tsx",lineNumber:637,columnNumber:25},this),e.jsxDEV(M,{variant:"outline",className:"mt-4",onClick:oe,children:[e.jsxDEV(ee,{className:"h-4 w-4 mr-2"},void 0,!1,{fileName:"/Users/ali/projects/self-flow-monorepo/packages/fe/src/pages/HomePage.tsx",lineNumber:643,columnNumber:27},this),"Create your first task"]},void 0,!0,{fileName:"/Users/ali/projects/self-flow-monorepo/packages/fe/src/pages/HomePage.tsx",lineNumber:638,columnNumber:25},this)]},void 0,!0,{fileName:"/Users/ali/projects/self-flow-monorepo/packages/fe/src/pages/HomePage.tsx",lineNumber:636,columnNumber:23},this):e.jsxDEV("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsxDEV("p",{children:"No daily goal for this date yet."},void 0,!1,{fileName:"/Users/ali/projects/self-flow-monorepo/packages/fe/src/pages/HomePage.tsx",lineNumber:649,columnNumber:25},this),e.jsxDEV(M,{variant:"outline",className:"mt-4",onClick:oe,children:[e.jsxDEV(ee,{className:"h-4 w-4 mr-2"},void 0,!1,{fileName:"/Users/ali/projects/self-flow-monorepo/packages/fe/src/pages/HomePage.tsx",lineNumber:655,columnNumber:27},this),"Add a task to create one"]},void 0,!0,{fileName:"/Users/ali/projects/self-flow-monorepo/packages/fe/src/pages/HomePage.tsx",lineNumber:650,columnNumber:25},this)]},void 0,!0,{fileName:"/Users/ali/projects/self-flow-monorepo/packages/fe/src/pages/HomePage.tsx",lineNumber:648,columnNumber:23},this)},void 0,!1,{fileName:"/Users/ali/projects/self-flow-monorepo/packages/fe/src/pages/HomePage.tsx",lineNumber:587,columnNumber:19},this),e.jsxDEV(de,{value:"kanban",children:t.length>0?e.jsxDEV(ce,{onDragEnd:E,children:e.jsxDEV("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4",children:Z.map(o=>e.jsxDEV(me,{droppableId:`kanban-${o.key}`,children:(a,n)=>e.jsxDEV("div",{ref:a.innerRef,...a.droppableProps,className:`border rounded-lg p-1 bg-muted/40 transition-colors ${n.isDraggingOver?"border-primary/70 bg-background":""}`,children:[e.jsxDEV("div",{className:"flex items-center justify-between mb-3",children:[e.jsxDEV("h3",{className:"text-sm font-semibold",children:o.label},void 0,!1,{fileName:"/Users/ali/projects/self-flow-monorepo/packages/fe/src/pages/HomePage.tsx",lineNumber:682,columnNumber:37},this),e.jsxDEV("span",{className:"text-xs text-muted-foreground",children:d[o.key].length},void 0,!1,{fileName:"/Users/ali/projects/self-flow-monorepo/packages/fe/src/pages/HomePage.tsx",lineNumber:685,columnNumber:37},this)]},void 0,!0,{fileName:"/Users/ali/projects/self-flow-monorepo/packages/fe/src/pages/HomePage.tsx",lineNumber:681,columnNumber:35},this),e.jsxDEV("div",{className:"space-y-2 min-h-[80px]",children:[d[o.key].filter(u=>u.id&&typeof u.id=="string").map((u,D)=>e.jsxDEV(fe,{draggableId:u.id,index:D,children:(j,P)=>e.jsxDEV("div",{ref:j.innerRef,...j.draggableProps,...j.dragHandleProps,className:`border rounded-lg bg-background shadow-sm transition-shadow ${P.isDragging?"shadow-lg border-primary":""}`,children:e.jsxDEV(ge,{task:u,onEditTask:te,onStatusChange:le,hiddenInfos:["status","effort","priority"]},void 0,!1,{fileName:"/Users/ali/projects/self-flow-monorepo/packages/fe/src/pages/HomePage.tsx",lineNumber:712,columnNumber:47},this)},void 0,!1,{fileName:"/Users/ali/projects/self-flow-monorepo/packages/fe/src/pages/HomePage.tsx",lineNumber:702,columnNumber:45},this)},u.id,!1,{fileName:"/Users/ali/projects/self-flow-monorepo/packages/fe/src/pages/HomePage.tsx",lineNumber:696,columnNumber:41},this)),d[o.key].length===0&&e.jsxDEV("p",{className:"text-xs text-muted-foreground text-center py-4",children:"No tasks"},void 0,!1,{fileName:"/Users/ali/projects/self-flow-monorepo/packages/fe/src/pages/HomePage.tsx",lineNumber:729,columnNumber:39},this),a.placeholder]},void 0,!0,{fileName:"/Users/ali/projects/self-flow-monorepo/packages/fe/src/pages/HomePage.tsx",lineNumber:689,columnNumber:35},this)]},void 0,!0,{fileName:"/Users/ali/projects/self-flow-monorepo/packages/fe/src/pages/HomePage.tsx",lineNumber:672,columnNumber:33},this)},o.key,!1,{fileName:"/Users/ali/projects/self-flow-monorepo/packages/fe/src/pages/HomePage.tsx",lineNumber:667,columnNumber:29},this))},void 0,!1,{fileName:"/Users/ali/projects/self-flow-monorepo/packages/fe/src/pages/HomePage.tsx",lineNumber:665,columnNumber:25},this)},void 0,!1,{fileName:"/Users/ali/projects/self-flow-monorepo/packages/fe/src/pages/HomePage.tsx",lineNumber:664,columnNumber:23},this):e.jsxDEV("div",{className:"text-center py-8 text-muted-foreground",children:e.jsxDEV("p",{children:"No tasks available to display."},void 0,!1,{fileName:"/Users/ali/projects/self-flow-monorepo/packages/fe/src/pages/HomePage.tsx",lineNumber:743,columnNumber:25},this)},void 0,!1,{fileName:"/Users/ali/projects/self-flow-monorepo/packages/fe/src/pages/HomePage.tsx",lineNumber:742,columnNumber:23},this)},void 0,!1,{fileName:"/Users/ali/projects/self-flow-monorepo/packages/fe/src/pages/HomePage.tsx",lineNumber:662,columnNumber:19},this)]},void 0,!0,{fileName:"/Users/ali/projects/self-flow-monorepo/packages/fe/src/pages/HomePage.tsx",lineNumber:576,columnNumber:17},this)},void 0,!1,{fileName:"/Users/ali/projects/self-flow-monorepo/packages/fe/src/pages/HomePage.tsx",lineNumber:575,columnNumber:15},this)]},void 0,!0,{fileName:"/Users/ali/projects/self-flow-monorepo/packages/fe/src/pages/HomePage.tsx",lineNumber:567,columnNumber:13},this)]},void 0,!0,{fileName:"/Users/ali/projects/self-flow-monorepo/packages/fe/src/pages/HomePage.tsx",lineNumber:531,columnNumber:9},this)},void 0,!1,{fileName:"/Users/ali/projects/self-flow-monorepo/packages/fe/src/pages/HomePage.tsx",lineNumber:530,columnNumber:7},this),e.jsxDEV(Se,{open:L,onOpenChange:U,task:Y,createForDate:x,onSaved:async()=>{await y(),U(!1),C({title:"",description:"",status:"todo",completed:!1}),await k(),m(o=>o+1)}},void 0,!1,{fileName:"/Users/ali/projects/self-flow-monorepo/packages/fe/src/pages/HomePage.tsx",lineNumber:755,columnNumber:7},this),e.jsxDEV(Ke,{open:Q,onOpenChange:l,selectedDate:x,onDateSelect:se},void 0,!1,{fileName:"/Users/ali/projects/self-flow-monorepo/packages/fe/src/pages/HomePage.tsx",lineNumber:775,columnNumber:7},this),e.jsxDEV(ke,{open:$,onOpenChange:V,goal:S,initialDate:S?void 0:x,initialTitle:S?void 0:Ve(x),onSaved:async()=>{await y(),V(!1),A(null),m(o=>o+1)}},void 0,!1,{fileName:"/Users/ali/projects/self-flow-monorepo/packages/fe/src/pages/HomePage.tsx",lineNumber:783,columnNumber:7},this)]},void 0,!0,{fileName:"/Users/ali/projects/self-flow-monorepo/packages/fe/src/pages/HomePage.tsx",lineNumber:520,columnNumber:5},this)}export{ns as default};
